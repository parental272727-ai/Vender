<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    
    <title>Invent√°rio PWA - Venda Pro</title>
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap');
        
        body { font-family: 'Outfit', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: contain; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
        
        .scanner-feed-container { width: 100%; height: 250px; background-color: #000; border-radius: 1rem; overflow: hidden; margin-bottom: 1rem; position: relative; }
        .scanner-feed-container video { width: 100%; height: 100%; object-fit: cover; }
        
        .input-elegant { width: 100%; padding: 0.5rem 0.75rem; border-radius: 0.5rem; border: 1px solid #e2e8f0; background-color: #fff; outline: none; transition: all 0.2s; font-size: 0.9rem; }
        .input-elegant:focus { border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
        .input-label { display: block; font-size: 0.7rem; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 0.2rem; margin-left: 0.2rem; }
        
        .product-thumb { width: 48px; height: 48px; object-fit: cover; border-radius: 0.5rem; background-color: #e2e8f0; }
        .photo-preview-container { position: relative; width: 100%; height: 160px; border-radius: 0.75rem; overflow: hidden; background-color: #f1f5f9; border: 2px dashed #cbd5e1; display: flex; align-items: center; justify-content: center; margin-top: 0.5rem; }
        .photo-preview-container img { width: 100%; height: 100%; object-fit: contain; background-color: #fff; }
        .btn-remove-photo { position: absolute; top: 8px; right: 8px; background-color: #ef4444; color: white; border-radius: 9999px; padding: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.2s; z-index: 10; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; }
        
        .option-chip { padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.8rem; font-weight: 600; color: #64748b; background: #fff; cursor: pointer; transition: all 0.2s; text-align: center; min-width: 40px; }
        .option-chip.selected { background-color: #4f46e5; color: white; border-color: #4f46e5; box-shadow: 0 2px 5px rgba(79, 70, 229, 0.3); }
        .btn-cart-action { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background-color: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; transition: all 0.2s; }
        .btn-cart-action:active { transform: scale(0.9); background-color: #15803d; color: white; }

        /* NOVOS ESTILOS PARA BOTOES + E - */
        .qty-control-group { display: flex; align-items: center; border: 1px solid #e2e8f0; border-radius: 0.5rem; background: white; overflow: hidden; height: 40px; }
        .btn-qty { width: 32px; height: 100%; display: flex; align-items: center; justify-content: center; background: #f8fafc; color: #475569; font-weight: bold; font-size: 1.1rem; border: none; transition: background 0.2s; }
        .btn-qty:active { background: #cbd5e1; }
        .btn-qty:disabled { opacity: 0.5; cursor: not-allowed; }
        .qty-display { width: 40px; text-align: center; font-weight: bold; border-left: 1px solid #e2e8f0; border-right: 1px solid #e2e8f0; font-size: 0.9rem; }
        
        /* Vers√£o menor para a tabela do carrinho */
        .qty-control-sm { height: 28px; border-radius: 6px; display: inline-flex; }
        .qty-control-sm .btn-qty { width: 24px; font-size: 0.9rem; }
        .qty-control-sm .qty-display { width: 30px; font-size: 0.8rem; line-height: 28px; }
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-800">

    <div id="online-status" class="fixed top-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-full text-xs font-bold bg-green-500 text-white shadow-lg opacity-0 transition pointer-events-none z-50">Sistema Pronto</div>

    <header class="bg-indigo-600/95 backdrop-blur-md text-white p-4 shadow-lg sticky top-0 z-40">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tight">Gest√£o de Vendas</h1>
            <div class="h-8 w-8 bg-indigo-500 rounded-full flex items-center justify-center text-xs font-bold shadow-inner">JR</div>
        </div>
    </header>

    <main id="app-container" class="flex-grow p-4 pb-24 max-w-3xl mx-auto w-full space-y-5 select-none">
        
        <div id="loading-state" class="flex flex-col items-center justify-center h-64 animate-pulse">
            <div class="h-12 w-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div>
            <p class="mt-4 text-slate-500 font-medium">Carregando...</p>
        </div>

        <div id="main-content" class="hidden animate-slide-up space-y-5">
            
            <div class="grid grid-cols-2 gap-3">
                <button id="btn-open-sell-modal" class="btn-active col-span-2 bg-gradient-to-r from-indigo-600 to-indigo-500 text-white p-5 rounded-2xl shadow-lg shadow-indigo-200 flex items-center justify-between group">
                    <div class="text-left"><span class="block text-2xl mb-1">üí∞</span><span class="font-bold text-lg">Nova Venda</span></div>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 opacity-50 group-hover:opacity-100 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                </button>
                <button id="btn-open-stock-list" class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center justify-center text-center gap-2 hover:bg-slate-50 transition">
                    <div class="h-10 w-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-xl">üì¶</div><span class="font-semibold text-sm text-slate-700">Estoque</span>
                </button>
                <button id="btn-add-product" class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center justify-center text-center gap-2 hover:bg-slate-50 transition">
                    <div class="h-10 w-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xl">üì∏</div><span class="font-semibold text-sm text-slate-700">Novo Produto</span>
                </button>
                <button id="btn-backup-data" class="col-span-2 bg-slate-800 text-white p-3 rounded-xl shadow-sm flex items-center justify-center gap-2 text-sm font-bold">
                    <span>üíæ</span> Backup / Restaurar
                </button>
            </div>

            <div id="section-low-stock" class="hidden bg-red-50 p-4 rounded-2xl border border-red-100 shadow-sm">
                <h2 class="text-sm font-bold text-red-600 flex items-center mb-2">‚ö†Ô∏è Estoque Baixo (<span id="low-stock-count">0</span>)</h2>
                <div id="low-stock-list" class="space-y-2"></div>
            </div>

            <div class="bg-white p-5 rounded-2xl shadow-md border border-slate-100">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-slate-700">Cat√°logo (Venda)</h2><span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded-md" id="catalog-count">0</span>
                </div>
                <div class="flex gap-2 mb-4 relative">
                    <div class="relative flex-grow">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></div>
                        <input type="text" id="catalog-search-input" placeholder="Buscar para vender..." class="input-elegant pl-10">
                    </div>
                    <button id="btn-scan-catalog" class="bg-slate-800 text-white px-4 rounded-xl shadow-lg hover:bg-slate-700 transition" title="Ler QR Code">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 14.5v.01M12 19h2m-4 0h2m-2-4h.01M9.5 7h.01" /><path stroke-linecap="round" stroke-linejoin="round" d="M5 11h14a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2z" /></svg>
                    </button>
                </div>
                <div id="scanner-area-catalog" class="hidden scanner-feed-container mb-4"><video id="catalog-scanner-feed"></video><button onclick="stopScanner();document.getElementById('scanner-area-catalog').classList.add('hidden')" class="absolute top-2 right-2 bg-black/50 text-white rounded-full p-2">‚úï</button></div>
                <div id="product-catalog-list" class="space-y-3 max-h-[50vh] overflow-y-auto pr-1"></div>
            </div>
            <div class="text-center pb-4"><code class="text-[0.6rem] text-slate-400">DB v1.9 (Qtd Control)</code></div>
        </div>
    </main>

    <div id="stock-list-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4" onclick="closeModal('stock-list-modal')">
        <div class="bg-white w-full max-w-md h-[85vh] rounded-2xl shadow-2xl p-6 animate-slide-up flex flex-col" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4 border-b border-slate-100 pb-2">
                <h3 class="text-xl font-bold text-slate-800">Gerenciar Estoque</h3>
                <button onclick="closeModal('stock-list-modal')" class="text-slate-400 hover:text-red-500 bg-slate-100 rounded-full p-2">‚úï</button>
            </div>
            <div class="mb-4"><input type="text" id="stock-search-input" placeholder="Filtrar produtos..." class="input-elegant"></div>
            <div id="stock-management-list" class="flex-grow overflow-y-auto space-y-3 pr-1"></div>
        </div>
    </div>

    <div id="product-options-modal" class="hidden fixed inset-0 z-[60] flex items-end sm:items-center justify-center bg-slate-900/80 backdrop-blur-sm" onclick="closeModal('product-options-modal')">
        <div class="bg-white w-full max-w-sm rounded-t-2xl sm:rounded-2xl p-6 animate-slide-up" onclick="event.stopPropagation()">
            <div class="flex items-center gap-4 mb-6">
                <img id="opt-product-img" class="h-16 w-16 bg-slate-100 rounded-lg object-cover">
                <div>
                    <h3 class="font-bold text-lg text-slate-800 leading-tight" id="opt-product-name">Produto</h3>
                    <p class="text-sm text-slate-500" id="opt-product-code">00000</p>
                    <p class="text-xs font-bold text-indigo-600 mt-1">Estoque: <span id="opt-product-stock">0</span></p>
                </div>
            </div>
            <div class="space-y-3">
                <button id="btn-opt-restock" class="w-full py-3 bg-green-50 text-green-700 font-bold rounded-xl border border-green-200 hover:bg-green-100 flex items-center justify-center gap-2">üì¶ Repor Estoque</button>
                <button id="btn-opt-edit" class="w-full py-3 bg-indigo-50 text-indigo-700 font-bold rounded-xl border border-indigo-200 hover:bg-indigo-100 flex items-center justify-center gap-2">‚úèÔ∏è Editar Dados</button>
                <button id="btn-opt-delete" class="w-full py-3 bg-red-50 text-red-600 font-bold rounded-xl border border-red-200 hover:bg-red-100 flex items-center justify-center gap-2">üóëÔ∏è Excluir Produto</button>
                <button onclick="closeModal('product-options-modal')" class="w-full py-3 text-slate-400 font-bold">Cancelar</button>
            </div>
        </div>
    </div>
    
    <div id="restock-input-modal" class="hidden fixed inset-0 z-[70] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4" onclick="closeModal('restock-input-modal')">
        <div class="bg-white w-full max-w-xs rounded-2xl shadow-2xl p-6 animate-slide-up" onclick="event.stopPropagation()">
            <h3 class="font-bold text-lg text-slate-800 mb-2">Adicionar Estoque</h3>
            <p class="text-sm text-slate-500 mb-4">Quantos itens entraram?</p>
            <input type="number" id="quick-restock-qty" class="input-elegant text-center text-lg font-bold mb-4" placeholder="0" autofocus>
            <div class="flex gap-2"><button onclick="closeModal('restock-input-modal')" class="flex-1 py-2 text-slate-500">Cancelar</button><button id="btn-confirm-quick-restock" class="flex-1 py-2 bg-green-500 text-white font-bold rounded-lg shadow">Confirmar</button></div>
        </div>
    </div>

    <div id="add-product-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4" onclick="closeModal('add-product-modal')">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 animate-slide-up max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <h3 class="text-xl font-bold mb-4 text-indigo-600">Novo Produto</h3>
            <button id="btn-open-scanner-new-product" class="w-full py-3 mb-4 bg-indigo-50 text-indigo-600 font-semibold rounded-xl hover:bg-indigo-100 transition flex items-center justify-center gap-2 border border-indigo-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 14.5v.01M12 19h2m-4 0h2m-2-4h.01M9.5 7h.01" /><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h6v6H3V3zm14 0h6v6h-6V3zM3 15h6v6H3v-6zm14 0h6v6h-6v-6z" /></svg> Ler QR / C√≥digo
            </button>
            <div id="scanner-area-new-product" class="hidden scanner-feed-container rounded-xl overflow-hidden mb-4"><video id="new-product-scanner-feed"></video></div>
            <form id="add-product-form" class="space-y-3">
                <div><label class="input-label">C√≥digo</label><input type="text" id="new-barcode" placeholder="EAN ou ID" required class="input-elegant font-mono"></div>
                <div><label class="input-label">Nome</label><input type="text" id="new-name" placeholder="Descri√ß√£o" required class="input-elegant"></div>
                <div class="flex gap-3"><div class="flex-1"><label class="input-label">Cor(es)</label><input type="text" id="new-color" placeholder="Ex: Azul, Vermelho" class="input-elegant"></div><div class="flex-1"><label class="input-label">Tamanho(s)</label><input type="text" id="new-size" placeholder="Ex: P, M, G" class="input-elegant text-center"></div></div>
                <div class="bg-indigo-50/80 p-3 rounded-xl border border-indigo-100 space-y-3">
                    <div class="flex gap-3"><div class="flex-1"><label class="input-label text-indigo-400">Custo (R$)</label><input type="number" id="new-cost" placeholder="0.00" step="0.01" class="input-elegant border-indigo-200" oninput="calculatePrice('new')"></div><div class="flex-1"><label class="input-label text-indigo-400">Lucro (%)</label><input type="number" id="new-margin" placeholder="%" step="1" class="input-elegant border-indigo-200" oninput="calculatePrice('new')"></div></div>
                    <div><label class="input-label text-indigo-600">Pre√ßo Venda (R$)</label><input type="number" id="new-price" placeholder="0.00" step="0.01" required class="input-elegant font-bold text-lg text-indigo-700 border-indigo-300"></div>
                </div>
                <div class="flex gap-3"><div class="flex-1"><label class="input-label">Estoque Atual</label><input type="number" id="new-stock" placeholder="0" required min="0" class="input-elegant"></div><div class="flex-1"><label class="input-label">Estoque M√≠n.</label><input type="number" id="new-min-stock" placeholder="1" required min="1" class="input-elegant"></div></div>
                <div class="bg-white p-2 rounded-xl border border-slate-200 mt-2"><label class="block w-full text-center py-2 bg-slate-50 text-slate-600 rounded-lg text-xs font-bold cursor-pointer hover:bg-slate-100 transition border border-slate-100">üì∏ Adicionar Foto <input type="file" id="new-product-photo" accept="image/*" class="hidden"></label><div id="new-photo-preview-container" class="photo-preview-container hidden"><img id="new-photo-img" src="" alt="Preview"><button type="button" class="btn-remove-photo" onclick="removePhoto('new')">‚úï</button></div></div>
                <div class="flex justify-end gap-3 pt-2"><button type="button" onclick="closeModal('add-product-modal')" class="px-4 py-2 text-slate-500 font-semibold text-sm">Cancelar</button><button type="submit" class="px-6 py-2 bg-indigo-600 text-white font-bold rounded-xl shadow text-sm">Salvar</button></div>
            </form>
        </div>
    </div>

    <div id="manage-product-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4" onclick="closeModal('manage-product-modal')">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 animate-slide-up max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold mb-4 text-slate-700 border-b pb-2">Editar Produto</h3>
            <form id="manage-product-form" class="space-y-3">
                <div><label class="input-label">C√≥digo</label><input type="text" id="manage-barcode" readonly class="w-full bg-slate-100 rounded border-none px-2 py-1 font-mono text-sm text-slate-500 outline-none"></div>
                <div><label class="input-label">Nome</label><input type="text" id="manage-name" required class="input-elegant"></div>
                <div class="flex gap-3"><div class="flex-1"><label class="input-label">Cor(es)</label><input type="text" id="manage-color" class="input-elegant"></div><div class="flex-1"><label class="input-label">Tamanho(s)</label><input type="text" id="manage-size" class="input-elegant text-center"></div></div>
                <div class="bg-slate-50 p-3 rounded-xl border border-slate-200 space-y-3">
                    <div class="flex gap-3"><div class="flex-1"><label class="input-label">Custo (R$)</label><input type="number" id="manage-cost" step="0.01" class="input-elegant" oninput="calculatePrice('manage')"></div><div class="flex-1"><label class="input-label">Lucro (%)</label><input type="number" id="manage-margin" step="1" class="input-elegant" oninput="calculatePrice('manage')"></div></div>
                    <div><label class="input-label text-indigo-600">Pre√ßo Venda (R$)</label><input type="number" id="manage-price" step="0.01" required class="input-elegant font-bold text-indigo-700"></div>
                </div>
                <div class="flex gap-3"><div class="flex-1"><label class="input-label">Estoque</label><input type="number" id="manage-stock" required min="0" class="input-elegant"></div><div class="flex-1"><label class="input-label">M√≠nimo</label><input type="number" id="manage-min-stock" required min="1" class="input-elegant"></div></div>
                <div class="bg-white p-2 rounded-xl border border-slate-200 mt-2"><label class="block w-full text-center py-2 bg-slate-50 text-slate-600 rounded-lg text-xs font-bold cursor-pointer hover:bg-slate-100 transition">Trocar Foto <input type="file" id="manage-product-photo" accept="image/*" class="hidden"></label><div id="manage-photo-preview-container" class="photo-preview-container hidden"><img id="manage-photo-img" src="" alt="Preview"><button type="button" class="btn-remove-photo" onclick="removePhoto('manage')">‚úï</button></div></div>
                <div class="flex flex-col gap-3 pt-4"><button type="submit" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-xl shadow">Salvar Altera√ß√µes</button><button type="button" onclick="closeModal('manage-product-modal')" class="text-slate-400 text-xs font-bold uppercase mt-2">Cancelar</button></div>
            </form>
        </div>
    </div>

    <div id="sell-modal" class="hidden fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-slate-900/60 backdrop-blur-sm" onclick="closeModal('sell-modal')">
        <div class="bg-white w-full max-w-lg h-[90vh] sm:h-auto sm:max-h-[90vh] rounded-t-3xl sm:rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-slide-up" onclick="event.stopPropagation()">
            <div class="bg-indigo-600 p-4 text-white flex justify-between items-center shadow-md z-10"><h3 class="font-bold text-lg">üõí Carrinho</h3><button onclick="closeModal('sell-modal')" class="bg-white/20 p-2 rounded-full">‚úï</button></div>
            <div class="flex-grow overflow-y-auto p-4 bg-slate-50">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 mb-4 sticky top-0 z-10">
                    <div class="flex gap-2 mb-3 items-center">
                        <input type="text" id="sell-barcode-input" placeholder="EAN..." class="input-elegant flex-grow font-mono text-sm">
                        <div class="qty-control-group w-32 ml-1">
                            <button class="btn-qty" onclick="adjustSellInputQty(-1)">-</button>
                            <input type="number" id="sell-quantity-input" value="1" min="1" class="bg-transparent text-center w-full h-full outline-none font-bold text-slate-700" disabled>
                            <button class="btn-qty" onclick="adjustSellInputQty(1)">+</button>
                        </div>
                    </div>
                    
                    <div id="sell-product-display" class="hidden animate-slide-up bg-indigo-50 p-3 rounded-lg border border-indigo-100 mb-2">
                        <div class="flex gap-3"><img id="sell-product-img" class="h-16 w-16 bg-white rounded-md object-cover border border-indigo-100" src="" style="display:none"><div class="flex-grow"><p class="font-bold text-indigo-900 text-sm leading-tight mb-1" id="sell-product-name"></p><p class="text-xs text-indigo-600">Disp: <span id="sell-current-stock" class="font-bold"></span></p><div class="flex items-center gap-1 mt-1"><span class="text-xs text-indigo-400">R$</span><input type="number" id="sell-unit-price" class="w-24 bg-white border border-indigo-200 rounded px-1 text-sm font-semibold text-indigo-700" step="0.01"></div></div></div>
                        
                        <div class="flex flex-col gap-2 pt-3 mt-2 border-t border-indigo-100/50">
                            <input type="hidden" id="sell-color-input">
                            <input type="hidden" id="sell-size-input">
                            <div id="selection-area-color" class="hidden"><p class="text-[0.65rem] font-bold text-indigo-400 uppercase mb-1">Cor</p><div id="container-color-options" class="flex flex-wrap gap-2"></div></div>
                            <div id="selection-area-size" class="hidden"><p class="text-[0.65rem] font-bold text-indigo-400 uppercase mb-1">Tamanho</p><div id="container-size-options" class="flex flex-wrap gap-2"></div></div>
                        </div>

                        <button id="btn-add-to-cart" class="w-full bg-indigo-600 text-white py-3 mt-3 rounded-xl font-bold text-sm shadow hover:bg-indigo-700 transition">Adicionar ao Carrinho</button>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden"><table class="w-full text-left text-sm"><tbody id="cart-items-list" class="divide-y divide-slate-100"></tbody></table></div>
            </div>
            <div class="bg-white p-4 border-t border-slate-100 shadow-lg z-20"><div class="flex justify-between items-end mb-4 px-1"><span class="text-slate-500 text-sm">Itens: <span id="cart-total-items" class="font-bold text-slate-800">0</span></span><div class="text-right"><p class="text-xs text-slate-400 font-bold uppercase">Total</p><p class="text-2xl font-bold text-indigo-700 leading-none">R$ <span id="cart-total-value">0.00</span></p></div></div><button id="btn-open-preview" class="w-full py-4 bg-emerald-500 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-emerald-600 disabled:opacity-50 transition" disabled>FINALIZAR VENDA</button></div>
        </div>
    </div>
    
    <div id="invoice-preview-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm p-4" onclick="closeModal('invoice-preview-modal')"><div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden animate-slide-up" onclick="event.stopPropagation()"><div class="bg-slate-100 p-4 border-b border-slate-200 flex justify-between items-center"><h3 class="font-bold text-slate-700">Resumo</h3><span id="preview-date" class="text-xs text-slate-500"></span></div><div class="p-4 max-h-[60vh] overflow-y-auto bg-white"><table class="w-full text-sm"><tbody id="preview-list"></tbody><tfoot><tr><td class="pt-3 font-bold">TOTAL:</td><td class="pt-3 text-right font-bold text-indigo-700" id="preview-total"></td></tr></tfoot></table></div><div class="p-4 bg-slate-50 flex gap-3"><button onclick="closeModal('invoice-preview-modal')" class="flex-1 py-3 bg-white border rounded-xl">Voltar</button><button id="btn-confirm-finalize" class="flex-1 py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg">Emitir Nota</button></div></div></div>
    <div id="backup-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4" onclick="closeModal('backup-modal')"><div class="bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 animate-slide-up"><h3 class="font-bold text-lg mb-4">Backup</h3><button onclick="exportData()" class="w-full py-3 bg-indigo-100 text-indigo-700 font-bold rounded-xl mb-3">Baixar Backup</button><div class="relative"><input type="file" class="absolute inset-0 opacity-0 w-full" onchange="importData(this)"><button class="w-full py-3 bg-slate-800 text-white font-bold rounded-xl">Restaurar Arquivo</button></div><button onclick="closeModal('backup-modal')" class="w-full py-2 text-slate-400 mt-2">Fechar</button></div></div>
    <div id="toast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 px-6 py-3 bg-slate-800 text-white rounded-full shadow-2xl transition-all duration-300 opacity-0 translate-y-10 z-[100] text-sm font-medium">Notifica√ß√£o</div>

    <script>
        const DB_NAME = 'InventoryDB_V7';
        const STORE_INVENTORY = 'inventory';
        const STORE_ORDERS = 'orders';
        let db, codeReader, cart = [], currentProductData = null, selectedProductForOptions = null;
        const { BrowserMultiFormatReader } = ZXing;
        const { jsPDF } = window.jspdf;

        window.calculatePrice = (prefix) => {
            const cost = parseFloat(document.getElementById(`${prefix}-cost`).value) || 0;
            const margin = parseFloat(document.getElementById(`${prefix}-margin`).value) || 0;
            if(cost >= 0) {
                const finalPrice = cost + (cost * (margin / 100));
                document.getElementById(`${prefix}-price`).value = finalPrice.toFixed(2);
            }
        };

        function compressImage(file) { return new Promise((resolve) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = (event) => { const img = new Image(); img.src = event.target.result; img.onload = () => { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); const MAX_WIDTH = 300; const scaleSize = MAX_WIDTH / img.width; canvas.width = MAX_WIDTH; canvas.height = img.height * scaleSize; ctx.drawImage(img, 0, 0, canvas.width, canvas.height); resolve(canvas.toDataURL('image/jpeg', 0.7)); }; }; }); }
        async function handlePhotoSelect(input, prefix) { if(input.files && input.files[0]) { const b64 = await compressImage(input.files[0]); document.getElementById(`${prefix}-photo-img`).src = b64; document.getElementById(`${prefix}-photo-preview-container`).classList.remove('hidden'); } }
        window.removePhoto = (prefix) => { document.getElementById(`${prefix}-product-photo`).value = ''; const img = document.getElementById(`${prefix}-photo-img`); img.src = ''; img.removeAttribute('src'); document.getElementById(`${prefix}-photo-preview-container`).classList.add('hidden'); };
        document.getElementById('new-product-photo').addEventListener('change', function() { handlePhotoSelect(this, 'new'); });
        document.getElementById('manage-product-photo').addEventListener('change', function() { handlePhotoSelect(this, 'manage'); });

        function initDB() { return new Promise((resolve) => { const req = indexedDB.open(DB_NAME, 1); req.onupgradeneeded = (e) => { const d = e.target.result; if (!d.objectStoreNames.contains(STORE_INVENTORY)) d.createObjectStore(STORE_INVENTORY, { keyPath: 'barcode' }); if (!d.objectStoreNames.contains(STORE_ORDERS)) d.createObjectStore(STORE_ORDERS, { keyPath: 'id', autoIncrement: true }); }; req.onsuccess = (e) => { db = e.target.result; resolve(); }; req.onerror = () => alert("Erro BD"); }); }
        const getInventory = () => new Promise(r => db.transaction(STORE_INVENTORY).objectStore(STORE_INVENTORY).getAll().onsuccess = e => r(e.target.result));
        const getProduct = (code) => new Promise(r => db.transaction(STORE_INVENTORY).objectStore(STORE_INVENTORY).get(code).onsuccess = e => r(e.target.result));
        const saveProduct = (p) => new Promise(r => { const tx = db.transaction(STORE_INVENTORY, 'readwrite'); tx.objectStore(STORE_INVENTORY).put(p); tx.oncomplete = r; });
        const deleteProduct = (code) => new Promise(r => { const tx = db.transaction(STORE_INVENTORY, 'readwrite'); tx.objectStore(STORE_INVENTORY).delete(code); tx.oncomplete = r; });
        const saveOrder = (o) => new Promise(r => { const tx = db.transaction(STORE_ORDERS, 'readwrite'); tx.objectStore(STORE_ORDERS).add(o).onsuccess = e => r(e.target.result); });

        function showToast(msg, type='info') { const t = document.getElementById('toast'); t.textContent = msg; t.className = `fixed bottom-6 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-full shadow-2xl transition-all duration-300 z-[100] text-sm font-medium ${type==='error'?'bg-red-500 text-white':'bg-slate-800 text-white'}`; t.classList.remove('opacity-0', 'translate-y-10'); setTimeout(() => t.classList.add('translate-y-10', 'opacity-0'), 3000); }
        window.openModal = (id) => { document.getElementById(id).classList.remove('hidden'); if(id==='sell-modal') renderCart(); };
        window.closeModal = (id) => { document.getElementById(id).classList.add('hidden'); stopScanner(); document.querySelectorAll('.scanner-feed-container').forEach(el => el.classList.add('hidden')); if(id === 'add-product-modal') { document.getElementById('add-product-form').reset(); removePhoto('new'); } };
        function stopScanner() { if (codeReader) { codeReader.reset(); codeReader = null; } }
        function startScanner(videoEl, cb, container) { stopScanner(); container.classList.remove('hidden'); codeReader = new BrowserMultiFormatReader(); codeReader.decodeFromVideoDevice(undefined, videoEl, (res) => { if(res) { stopScanner(); container.classList.add('hidden'); cb(res.text); showToast('Lido!'); } }).catch(() => container.innerHTML = '<p class="text-white text-center p-4">Erro C√¢mera</p>'); }

        window.prepareProductOptions = async (code) => { const p = await getProduct(code); if(p) openProductOptions(p); };

        async function renderCatalog(filter='', listId = 'product-catalog-list', clickAction = 'sell') {
            const list = document.getElementById(listId); list.innerHTML = '';
            const all = await getInventory();
            const items = all.filter(i => i.name.toLowerCase().includes(filter.toLowerCase()) || i.barcode.includes(filter));
            if(listId === 'product-catalog-list') document.getElementById('catalog-count').textContent = items.length;
            
            items.forEach(p => {
                const imgHTML = p.photo ? `<img src="${p.photo}" class="product-thumb">` : `<div class="product-thumb flex items-center justify-center text-slate-300 text-xs font-bold bg-slate-200">SEM</div>`;
                const listEl = document.createElement('div');
                listEl.className = 'bg-white p-3 rounded-xl shadow-sm border border-slate-100 flex items-center gap-3 active:bg-slate-50 transition';
                
                let actionBtnHTML = '';
                if(clickAction === 'sell') {
                    listEl.onclick = (e) => { if(!e.target.closest('.btn-cart-action')) selectForSell(p.barcode); }; 
                    actionBtnHTML = `<button class="btn-cart-action shadow-sm" onclick="selectForSell('${p.barcode}')">üõí</button>`;
                } else if(clickAction === 'manage') {
                    listEl.onclick = () => prepareProductOptions(p.barcode);
                }

                listEl.innerHTML = `${imgHTML}<div class="flex-grow overflow-hidden"><p class="font-bold text-slate-800 truncate text-sm">${p.name}</p><p class="text-xs text-slate-500 font-mono">${p.barcode}</p><div class="flex gap-2 mt-1"><span class="text-[0.65rem] px-2 rounded ${p.stock<=p.minStock?'bg-red-100 text-red-600':'bg-green-100 text-green-700'} font-bold">Estoque: ${p.stock}</span><span class="text-[0.65rem] bg-indigo-50 text-indigo-600 px-2 rounded font-bold">R$ ${p.unitPrice.toFixed(2)}</span></div></div>${actionBtnHTML}`;
                list.appendChild(listEl);
            });

            if(listId === 'product-catalog-list') {
                const low = all.filter(i => i.stock <= i.minStock);
                document.getElementById('low-stock-count').textContent = low.length;
                const lowList = document.getElementById('low-stock-list'); lowList.innerHTML = '';
                if(low.length>0) { document.getElementById('section-low-stock').classList.remove('hidden'); low.forEach(p => lowList.innerHTML += `<div class="bg-white p-2 rounded text-xs flex justify-between items-center cursor-pointer" onclick="prepareProductOptions('${p.barcode}')"><span>${p.name}</span><span class="text-red-500 font-bold">${p.stock} un</span></div>`); } else document.getElementById('section-low-stock').classList.add('hidden');
            }
        }

        function openProductOptions(p) {
            selectedProductForOptions = p;
            document.getElementById('opt-product-name').textContent = p.name;
            document.getElementById('opt-product-code').textContent = p.barcode;
            document.getElementById('opt-product-stock').textContent = p.stock + ' unidades';
            document.getElementById('opt-product-img').src = p.photo || '';
            openModal('product-options-modal');
        }

        document.getElementById('btn-opt-restock').onclick = () => { closeModal('product-options-modal'); document.getElementById('quick-restock-qty').value = ''; openModal('restock-input-modal'); setTimeout(() => document.getElementById('quick-restock-qty').focus(), 100); };
        document.getElementById('btn-confirm-quick-restock').onclick = async () => { const qty = parseInt(document.getElementById('quick-restock-qty').value); if(selectedProductForOptions && !isNaN(qty)) { selectedProductForOptions.stock += qty; await saveProduct(selectedProductForOptions); closeModal('restock-input-modal'); showToast('Estoque Adicionado!', 'success'); refreshAllLists(); } };
        document.getElementById('btn-opt-edit').onclick = () => { closeModal('product-options-modal'); editProduct(selectedProductForOptions.barcode); };
        document.getElementById('btn-opt-delete').onclick = async () => { if(confirm(`Excluir ${selectedProductForOptions.name}?`)) { await deleteProduct(selectedProductForOptions.barcode); closeModal('product-options-modal'); showToast('Produto exclu√≠do'); refreshAllLists(); } };

        function generateOptions(dataString, containerId, inputId) {
            const container = document.getElementById(containerId); const input = document.getElementById(inputId);
            container.innerHTML = ''; input.value = '';
            if (!dataString) return false;
            const options = dataString.split(',').map(s => s.trim()).filter(s => s !== '');
            if (options.length === 0) return false;
            options.forEach((opt, index) => {
                const btn = document.createElement('div'); btn.className = 'option-chip'; btn.textContent = opt;
                btn.onclick = () => { container.querySelectorAll('.option-chip').forEach(c => c.classList.remove('selected')); btn.classList.add('selected'); input.value = opt; };
                if (index === 0) { btn.classList.add('selected'); input.value = opt; }
                container.appendChild(btn);
            });
            return true;
        }

        async function selectForSell(code) {
            const p = await getProduct(code);
            if(!p) return showToast('N√£o encontrado', 'error');
            currentProductData = p;
            
            document.getElementById('sell-barcode-input').value = p.barcode;
            document.getElementById('sell-product-name').textContent = p.name;
            document.getElementById('sell-current-stock').textContent = p.stock;
            document.getElementById('sell-unit-price').value = p.unitPrice.toFixed(2);
            document.getElementById('sell-quantity-input').value = 1;
            
            const hasColors = generateOptions(p.color, 'container-color-options', 'sell-color-input');
            const hasSizes = generateOptions(p.size, 'container-size-options', 'sell-size-input');
            
            if(hasColors) document.getElementById('selection-area-color').classList.remove('hidden'); else document.getElementById('selection-area-color').classList.add('hidden');
            if(hasSizes) document.getElementById('selection-area-size').classList.remove('hidden'); else document.getElementById('selection-area-size').classList.add('hidden');

            document.getElementById('sell-quantity-input').disabled = false;
            document.getElementById('sell-product-display').classList.remove('hidden');
            const imgEl = document.getElementById('sell-product-img');
            if(p.photo) { imgEl.src = p.photo; imgEl.style.display = 'block'; } else { imgEl.style.display = 'none'; }
            openModal('sell-modal');
        }

        // L√≥gica do bot√£o +/- no modal de input principal
        window.adjustSellInputQty = (delta) => {
            if(!currentProductData) return;
            const input = document.getElementById('sell-quantity-input');
            let val = parseInt(input.value) || 0;
            const newVal = val + delta;
            if(newVal >= 1) {
                // Checagem simples de estoque m√°ximo na entrada
                if(newVal > currentProductData.stock) {
                    showToast('Estoque m√°ximo atingido', 'error');
                } else {
                    input.value = newVal;
                }
            }
        };

        // L√≥gica do bot√£o +/- dentro da tabela do carrinho
        window.updateCartQty = async (index, delta) => {
            const item = cart[index];
            const p = await getProduct(item.barcode);
            const newQty = item.quantity + delta;
            
            if (newQty < 1) return; // N√£o deixa baixar de 1 (use o X para apagar)

            // Verifica estoque total (considerando que o estoque no DB ainda est√° cheio, s√≥ baixa no final)
            // Se o usu√°rio j√° tem 5 no carrinho e o estoque √© 5, n√£o pode aumentar
            if (newQty > p.stock) {
                return showToast('Estoque insuficiente!', 'error');
            }

            item.quantity = newQty;
            item.total = item.quantity * item.unitPrice;
            renderCart();
        };

        async function editProduct(code) {
            const p = await getProduct(code);
            document.getElementById('manage-barcode').value = p.barcode;
            document.getElementById('manage-name').value = p.name;
            document.getElementById('manage-stock').value = p.stock;
            document.getElementById('manage-min-stock').value = p.minStock;
            document.getElementById('manage-price').value = p.unitPrice.toFixed(2);
            document.getElementById('manage-color').value = p.color || '';
            document.getElementById('manage-size').value = p.size || '';
            document.getElementById('manage-cost').value = p.costPrice || '';
            document.getElementById('manage-margin').value = p.profitMargin || '';
            if(p.photo) { document.getElementById('manage-photo-img').src = p.photo; document.getElementById('manage-photo-preview-container').classList.remove('hidden'); } else { removePhoto('manage'); }
            openModal('manage-product-modal');
            document.getElementById('manage-product-form').onsubmit = async (e) => {
                e.preventDefault();
                const fileInput = document.getElementById('manage-product-photo');
                const imgPreview = document.getElementById('manage-photo-img');
                let photoData = null;
                if (fileInput.files[0]) { photoData = await compressImage(fileInput.files[0]); } else if (imgPreview.src && imgPreview.src.length > 100) { photoData = p.photo; }
                await saveProduct({ ...p, name: document.getElementById('manage-name').value, stock: parseInt(document.getElementById('manage-stock').value), minStock: parseInt(document.getElementById('manage-min-stock').value), unitPrice: parseFloat(document.getElementById('manage-price').value), color: document.getElementById('manage-color').value, size: document.getElementById('manage-size').value, costPrice: parseFloat(document.getElementById('manage-cost').value) || 0, profitMargin: parseFloat(document.getElementById('manage-margin').value) || 0, photo: photoData });
                closeModal('manage-product-modal'); showToast('Atualizado!'); refreshAllLists();
            };
        }

        document.getElementById('add-product-form').onsubmit = async (e) => {
            e.preventDefault();
            const code = document.getElementById('new-barcode').value;
            if(await getProduct(code)) return showToast('C√≥digo j√° existe!', 'error');
            const fileInput = document.getElementById('new-product-photo');
            let photoData = null; if(fileInput.files[0]) photoData = await compressImage(fileInput.files[0]);
            await saveProduct({ barcode: code, name: document.getElementById('new-name').value, stock: parseInt(document.getElementById('new-stock').value), minStock: parseInt(document.getElementById('new-min-stock').value), unitPrice: parseFloat(document.getElementById('new-price').value), color: document.getElementById('new-color').value, size: document.getElementById('new-size').value, costPrice: parseFloat(document.getElementById('new-cost').value) || 0, profitMargin: parseFloat(document.getElementById('new-margin').value) || 0, photo: photoData });
            closeModal('add-product-modal'); showToast('Criado!'); refreshAllLists();
        };

        document.getElementById('btn-add-to-cart').onclick = () => {
            if(!currentProductData) return;
            const q = parseInt(document.getElementById('sell-quantity-input').value);
            const price = parseFloat(document.getElementById('sell-unit-price').value);
            const exists = cart.find(c => c.barcode === currentProductData.barcode);
            const color = document.getElementById('sell-color-input').value;
            const size = document.getElementById('sell-size-input').value;
            
            if (currentProductData.stock < q) return showToast('Estoque insuficiente', 'error');

            const cartItem = cart.find(c => c.barcode === currentProductData.barcode && c.color === color && c.size === size);
            
            if(cartItem) { 
                if(cartItem.quantity + q > currentProductData.stock) return showToast('Estoque insuficiente', 'error');
                cartItem.quantity += q; 
                cartItem.total = cartItem.quantity * price; 
            } else { 
                cart.push({ barcode: currentProductData.barcode, name: currentProductData.name, quantity: q, unitPrice: price, total: q*price, color: color, size: size }); 
            }
            
            renderCart(); document.getElementById('sell-product-display').classList.add('hidden'); document.getElementById('sell-barcode-input').value = ''; showToast('Adicionado!');
        };

        function renderCart() { 
            const list = document.getElementById('cart-items-list'); list.innerHTML = ''; let t = 0, q = 0; 
            cart.forEach((c,i) => { 
                list.innerHTML += `
                <tr>
                    <td class="p-3">
                        <div>${c.name}</div>
                        <div class="text-xs text-slate-500 font-bold">${c.color ? 'Cor: '+c.color : ''} ${c.size ? '| Tam: '+c.size : ''}</div>
                    </td>
                    <td class="text-center align-middle">
                        <div class="qty-control-group qty-control-sm mx-auto">
                            <button class="btn-qty" onclick="updateCartQty(${i}, -1)">-</button>
                            <span class="qty-display">${c.quantity}</span>
                            <button class="btn-qty" onclick="updateCartQty(${i}, 1)">+</button>
                        </div>
                    </td>
                    <td class="text-right align-middle">R$ ${c.total.toFixed(2)}</td>
                    <td class="text-center align-middle"><button class="text-red-500 font-bold p-2" onclick="cart.splice(${i},1);renderCart()">‚úï</button></td>
                </tr>`; 
                t+=c.total; q+=c.quantity; 
            }); 
            document.getElementById('cart-total-value').textContent = t.toFixed(2); 
            document.getElementById('cart-total-items').textContent = q; 
            document.getElementById('btn-open-preview').disabled = cart.length === 0; 
        }

        document.getElementById('btn-open-preview').onclick = () => { const list = document.getElementById('preview-list'); list.innerHTML = ''; cart.forEach(c => list.innerHTML += `<tr><td class="py-1"><div>${c.name}</div><div class="text-[0.65rem] text-slate-400">${c.color||''} ${c.size||''}</div></td><td class="text-right">R$ ${c.total.toFixed(2)}</td></tr>`); document.getElementById('preview-total').textContent = document.getElementById('cart-total-value').textContent; document.getElementById('preview-date').textContent = new Date().toLocaleString(); openModal('invoice-preview-modal'); };
        document.getElementById('btn-confirm-finalize').onclick = async () => { for(const item of cart) { const p = await getProduct(item.barcode); p.stock -= item.quantity; await saveProduct(p); } const id = await saveOrder({ items: cart, total: parseFloat(document.getElementById('cart-total-value').textContent), date: new Date() }); const doc = new jsPDF(); doc.text(`Recibo #${id}`, 10, 10); let y=20; cart.forEach(c => { doc.text(`${c.quantity}x ${c.name} (${c.color||'-'} ${c.size||'-'}) - R$ ${c.total.toFixed(2)}`, 10, y); y+=10; }); doc.text(`Total: R$ ${document.getElementById('cart-total-value').textContent}`, 10, y+10); doc.save(`Venda_${id}.pdf`); cart=[]; closeModal('invoice-preview-modal'); closeModal('sell-modal'); refreshAllLists(); showToast('Venda Finalizada!', 'success'); };

        window.exportData = async () => { const data = await getInventory(); const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(data)], {type:'application/json'})); a.download = 'backup.json'; a.click(); };
        window.importData = (input) => { const r = new FileReader(); r.onload = async (e) => { JSON.parse(e.target.result).forEach(async p => await saveProduct(p)); closeModal('backup-modal'); refreshAllLists(); showToast('Restaurado!'); }; r.readAsText(input.files[0]); };

        function refreshAllLists() {
            renderCatalog('', 'product-catalog-list', 'sell');
            renderCatalog('', 'stock-management-list', 'manage');
        }

        window.onload = async () => {
            await initDB();
            if ('serviceWorker' in navigator) navigator.serviceWorker.register('./service-worker.js');
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            refreshAllLists();
            
            document.getElementById('btn-open-sell-modal').onclick = () => openModal('sell-modal');
            document.getElementById('btn-open-stock-list').onclick = () => { openModal('stock-list-modal'); renderCatalog('', 'stock-management-list', 'manage'); };
            document.getElementById('btn-add-product').onclick = () => openModal('add-product-modal');
            document.getElementById('btn-backup-data').onclick = () => openModal('backup-modal');
            
            document.getElementById('btn-scan-catalog').onclick = () => startScanner(document.getElementById('catalog-scanner-feed'), (t)=>{ document.getElementById('catalog-search-input').value=t; renderCatalog(t, 'product-catalog-list', 'sell'); }, document.getElementById('scanner-area-catalog'));
            document.getElementById('btn-open-scanner-new-product').onclick = () => startScanner(document.getElementById('new-product-scanner-feed'), (t)=>{ document.getElementById('new-barcode').value=t; }, document.getElementById('scanner-area-new-product'));
            
            document.getElementById('catalog-search-input').addEventListener('input', (e) => renderCatalog(e.target.value, 'product-catalog-list', 'sell'));
            document.getElementById('stock-search-input').addEventListener('input', (e) => renderCatalog(e.target.value, 'stock-management-list', 'manage'));
            document.getElementById('sell-barcode-input').addEventListener('input', (e) => { clearTimeout(e.target.t); e.target.t=setTimeout(()=>selectForSell(e.target.value), 500); });
        };
    </script>
</body>
</html>

